(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"862v":function(t,e,i){"use strict";i.r(e),i.d(e,"MapPageModule",(function(){return st}));var n=i("ofXK"),o=i("3Pt+"),r=i("TEn/"),a=i("tyNb"),s=i("mrSG"),c=i("uFMf"),p=i("xGJU"),l=i("PV97"),h=i("Dwri"),d=i("OcId"),u=i("uxLX"),m=i("ZwNh"),f=i("8geo"),_=i("6AEr"),b=i("AihK"),y=i("rCk2"),g=i("wd/R"),v=i("fXoL"),k=i("HYNq"),C=i("ri4K"),w=i("bANG"),x=i("ohih"),L=i("IYJ9"),O=i("/XPu"),P=i("Bfh1"),S=i("aaCY");function T(t,e){if(1&t){var i=v.Lb();v.Kb(0,"div",45),v.Sb("click",(function(){v.ec(i);var t=v.Ub();return t.mapLayersOpened=!1,t.showLayer=!1})),v.Jb()}}function I(t,e){if(1&t&&(v.Kb(0,"ion-segment-button",46),v.Kb(1,"ion-label"),v.lc(2),v.Jb(),v.Jb()),2&t){var i=v.Ub();v.xb(2),v.mc(i.currentGroup.name)}}function j(t,e){1&t&&(v.Kb(0,"ion-segment-button",47),v.Kb(1,"ion-label"),v.lc(2,"My Map"),v.Jb(),v.Jb())}function F(t,e){if(1&t){var i=v.Lb();v.Kb(0,"ion-item",14),v.Sb("click",(function(){v.ec(i);var t=e.$implicit;return v.Ub(2).viewLayer(t)})),v.Kb(1,"ion-label"),v.lc(2),v.Jb(),v.Kb(3,"ion-button",49),v.Sb("click",(function(t){v.ec(i);var n=e.$implicit;return v.Ub(2).toggleLayerVisibility(n,t)})),v.Ib(4,"ion-icon",50),v.Jb(),v.Jb()}if(2&t){var n=e.$implicit;v.xb(2),v.nc(" ",n.name," "),v.xb(2),v.Xb("name",n.visible?"eye":"eye-off")}}function D(t,e){if(1&t&&(v.Kb(0,"ion-list"),v.kc(1,F,5,2,"ion-item",48),v.Jb()),2&t){var i=v.Ub();v.xb(1),v.Xb("ngForOf",i.defaultLayers)}}function J(t,e){if(1&t){var i=v.Lb();v.Kb(0,"ion-item",14),v.Sb("click",(function(){v.ec(i);var t=e.$implicit;return v.Ub(2).viewLayer(t)})),v.Kb(1,"ion-label"),v.lc(2),v.Jb(),v.Kb(3,"ion-button",49),v.Sb("click",(function(t){v.ec(i);var n=e.$implicit;return v.Ub(2).toggleLayerVisibility(n,t)})),v.Ib(4,"ion-icon",50),v.Jb(),v.Jb()}if(2&t){var n=e.$implicit;v.xb(2),v.nc(" ",n.name," "),v.xb(2),v.Xb("name",n.visible?"eye":"eye-off")}}function K(t,e){if(1&t&&(v.Kb(0,"ion-list"),v.kc(1,J,5,2,"ion-item",48),v.Jb()),2&t){var i=v.Ub();v.xb(1),v.Xb("ngForOf",i.groupLayers)}}function G(t,e){if(1&t){var i=v.Lb();v.Kb(0,"ion-item",14),v.Sb("click",(function(){v.ec(i);var t=e.$implicit;return v.Ub(2).viewLayer(t)})),v.Kb(1,"ion-label"),v.lc(2),v.Jb(),v.Kb(3,"ion-button",49),v.Sb("click",(function(t){v.ec(i);var n=e.$implicit;return v.Ub(2).toggleLayerVisibility(n,t)})),v.Ib(4,"ion-icon",50),v.Jb(),v.Jb()}if(2&t){var n=e.$implicit;v.xb(2),v.nc(" ",n.name," "),v.xb(2),v.Xb("name",n.visible?"eye":"eye-off")}}function M(t,e){if(1&t&&(v.Kb(0,"ion-list"),v.kc(1,G,5,2,"ion-item",48),v.Jb()),2&t){var i=v.Ub();v.xb(1),v.Xb("ngForOf",i.privateLayers)}}function E(t,e){1&t&&v.Ib(0,"ion-icon",54)}function A(t,e){1&t&&v.Ib(0,"ion-icon",55)}function X(t,e){if(1&t&&(v.Kb(0,"h3"),v.lc(1),v.Jb()),2&t){var i=v.Ub().$implicit;v.xb(1),v.nc("Created by ",i.profile.name,"")}}function R(t,e){if(1&t){var i=v.Lb();v.Kb(0,"ion-button",49),v.Sb("click",(function(t){v.ec(i);var e=v.Ub().$implicit;return v.Ub(2).togglePlacemarkVisibility(e,t)})),v.Ib(1,"ion-icon",50),v.Jb()}if(2&t){var n=v.Ub().$implicit;v.xb(1),v.Xb("name",n.visible?"eye":"eye-off")}}function U(t,e){if(1&t){var i=v.Lb();v.Kb(0,"ion-button",49),v.Sb("click",(function(t){v.ec(i);var e=v.Ub().$implicit;return v.Ub(2).toggleTrackVisibility(e,t)})),v.Ib(1,"ion-icon",50),v.Jb()}if(2&t){var n=v.Ub().$implicit;v.xb(1),v.Xb("name",n.visible?"eye":"eye-off")}}function N(t,e){if(1&t){var i=v.Lb();v.Kb(0,"ion-item",14),v.Sb("click",(function(){v.ec(i);var t=e.$implicit;return v.Ub(2).viewItem(t)})),v.kc(1,E,1,0,"ion-icon",51),v.kc(2,A,1,0,"ion-icon",52),v.Kb(3,"ion-label"),v.Kb(4,"h2"),v.lc(5),v.Jb(),v.kc(6,X,2,1,"h3",20),v.Kb(7,"p"),v.lc(8),v.Jb(),v.Jb(),v.kc(9,R,2,1,"ion-button",53),v.kc(10,U,2,1,"ion-button",53),v.Jb()}if(2&t){var n=e.$implicit,o=v.Ub(2);v.xb(1),v.Xb("ngIf",n.point_type),v.xb(1),v.Xb("ngIf",!n.point_type),v.xb(3),v.mc(n.name),v.xb(1),v.Xb("ngIf",n.profile),v.xb(2),v.nc(" Created ",o.formatFromNow(n.created_at)," "),v.xb(1),v.Xb("ngIf",n.point_type),v.xb(1),v.Xb("ngIf",!n.point_type)}}function V(t,e){if(1&t&&(v.Kb(0,"ion-list"),v.kc(1,N,11,7,"ion-item",48),v.Jb()),2&t){var i=v.Ub();v.xb(1),v.Xb("ngForOf",i.currentLayer.layer_items)}}function H(t,e){if(1&t){var i=v.Lb();v.Kb(0,"div",56),v.Sb("click",(function(){return v.ec(i),v.Ub().mapTypesOpened=!1})),v.Jb()}}var z=function(t){return{"background-image":t}},Y=function(t){return{"map__map-types__map-type__tile--selected":t}};function $(t,e){if(1&t){var i=v.Lb();v.Kb(0,"div",57),v.Kb(1,"div",58),v.Sb("click",(function(){v.ec(i);var t=e.index;return v.Ub().setVisibility(t)})),v.Kb(2,"span"),v.lc(3),v.Jb(),v.Jb(),v.Kb(4,"ion-item",59),v.Kb(5,"ion-range",60),v.Sb("ngModelChange",(function(t){return v.ec(i),e.$implicit.opacity=t}))("ionChange",(function(){v.ec(i);var t=e.index;return v.Ub().updateOpacity(t)})),v.Jb(),v.Jb(),v.Jb()}if(2&t){var n=e.$implicit,o=e.index;v.xb(1),v.Xb("ngStyle",v.ac(5,z,"url("+n.image+")"))("ngClass",v.ac(7,Y,n.visible)),v.xb(2),v.mc(n.name),v.xb(2),v.Yb("id","layer",o,"-opacity"),v.Xb("ngModel",n.opacity)}}function q(t,e){if(1&t){var i=v.Lb();v.Kb(0,"div",61),v.Kb(1,"ion-button",62),v.Sb("click",(function(){return v.ec(i),v.Ub().recenter()})),v.Ib(2,"ion-icon",63),v.lc(3," Re-center "),v.Jb(),v.Jb()}}function W(t,e){1&t&&(v.Kb(0,"span"),v.lc(1,"Track"),v.Jb())}function B(t,e){1&t&&(v.Kb(0,"span"),v.lc(1,"Stop"),v.Jb())}var Q=function(t){return{opacity:t}},Z=function(t){return{"map__container--windy-visible":t}},tt=function(t){return{"map__layers--opened":t}},et=function(t){return{"map__layer--opened":t}},it=function(t){return{"map__map-types--opened":t}},nt=function(t){return{active:t}},ot=function(t){return{"map-tabs__tab--opened":t}},rt=[{path:"",component:function(){function t(t,e,i,n,o,r,a,s,c,p,l,h,d){var u=this;this.mapService=t,this.menu=e,this.alertController=i,this.modalController=n,this.authenticationService=o,this.layerService=r,this.groupService=a,this.toastController=s,this.billingService=c,this.socialSharing=p,this.geolocation=l,this.deviceOrientation=h,this.loadingController=d,this.mapTypes=this.mapService.getMapTypes(),this.mapTypesOpened=!1,this.defaultLayers=[],this.groupLayers=[],this.privateLayers=[],this.mapLayersOpened=!1,this.activeGroupTab="myoutdoors",this.currentLayer={},this.getLayers(),this.search="",this.user={},this.trackedCoordinates=[],this.isTracking=!1,this.showingUpgrade=!1,this.authenticationService.getUserData().subscribe((function(t){u.user=t;var e=g(u.user.created_at).add(1,"month");"admin"!==u.user.permission&&(!u.user.stripe_id&&g().isAfter(e)||u.user.subscription&&g().isAfter(g(u.user.subscription.ends_at)))&&u.showUpgrade()})),this.currentGroup={},this.groupService.subscribeCurrentGroup().subscribe((function(t){u.currentGroup=t,u.getGroupLayers()})),this.groupService.getCurrentGroup().then((function(t){t?(u.groupService.setCurrentGroup(t),u.getGroupLayers()):u.groupService.getJoinedGroups().then((function(t){t&&t.length&&t.length>0&&(u.groupService.setCurrentGroup(t[0]),u.getGroupLayers())}))})),this.deviceOrientation.watchHeading({frequency:3e3}).subscribe((function(t){console.log(t);var e=t.trueHeading;if(document.getElementById("compass-icon").style.transform="rotate("+e+"deg)",u.map){var i=u.map.getView().getRotation();console.log(i);var n=e-i;document.getElementById("currentposition").style.transform="rotate("+n+"deg)"}}))}return t.prototype.ngOnInit=function(){var t=this;setTimeout((function(){t.mapService.getMapConfig().then((function(e){t.map=e,t.setMapEvents(),t.windy=t.mapService.getWindyConfig(),t.recenter()}))}),500)},t.prototype.clearDrawFeatures=function(){this.mapService.vectorSource&&this.mapService.vectorSource.clear()},t.prototype.addTrack=function(){var t=this;this.enableAddPlacemark&&this.addPlacemark(),this.enableAddTrack=!this.enableAddTrack,this.enableAddTrack?(this.windyOpacity=0,this.mapService.windyVisibility=0,this.trackInteraction=new y.a({source:this.mapService.vectorSource,type:"LineString"}),this.map.addInteraction(this.trackInteraction),this.trackInteraction.on("drawend",(function(e){var i=e.feature,n=i.getGeometry(),o=(n.getCoordinates(),t.mapService.getDistance(n.getLength()));console.log(o),t.alertController.create({header:"Distance",message:o,buttons:[{text:"Dismiss",role:"cancel"}]}).then((function(e){e.present(),e.onDidDismiss().then((function(){t.map.removeInteraction(t.trackInteraction),t.mapService.vectorSource.removeFeature(i)}))})),t.enableAddTrack=!t.enableAddTrack}))):this.map.removeInteraction(this.trackInteraction)},t.prototype.addPlacemark=function(){var t=this;this.enableAddTrack&&this.addTrack(),this.enableAddPlacemark=!this.enableAddPlacemark,this.enableAddPlacemark?(this.windyOpacity=0,this.mapService.windyVisibility=0,this.placemarkInteraction=new y.a({source:this.mapService.vectorSource,type:"Point"}),this.map.addInteraction(this.placemarkInteraction),this.placemarkInteraction.on("drawend",(function(e){var i=e.feature,n=i.getGeometry().getCoordinates();t.showAddPlacemark(n,i)}))):this.map.removeInteraction(this.placemarkInteraction)},t.prototype.showAddPlacemark=function(t,e){return Object(s.a)(this,void 0,void 0,(function(){var i,n=this;return Object(s.c)(this,(function(o){switch(o.label){case 0:return[4,this.modalController.create({component:l.a,componentProps:{placemark:this.user.id}})];case 1:return(i=o.sent()).onDidDismiss().then((function(i){if(i&&i.data){console.log(i);var o=i.data.placemark;o.latitude=t[0],o.longitude=t[1],o.point_type="placemark",n.layerService.createPlacemark(o).then((function(t){e.setId("placemark-"+t.id),n.getLayers(),n.getGroupLayers(),n.mapService.showPlacemark(t)})),n.map.removeInteraction(n.placemarkInteraction),n.enableAddPlacemark=!n.enableAddPlacemark}else console.log("remove feat"),n.mapService.vectorSource.removeFeature(e),n.map.removeInteraction(n.placemarkInteraction),n.enableAddPlacemark=!n.enableAddPlacemark})),[4,i.present()];case 2:return o.sent(),[2]}}))}))},t.prototype.recenter=function(){var t,e=this;this.recenterActive=!1,this.loadingController.create({message:"Re-centering...",duration:2e4}).then((function(e){t=e,e.present()})),this.geolocation.getCurrentPosition({enableHighAccuracy:!0}).then((function(i){t.dismiss(),i&&i.coords&&(e.mapService.updateCurrentPosition({latitude:i.coords.latitude,longitude:i.coords.longitude}),e.mapService.leafletMap?e.mapService.moveMapsLatLng(i.coords.latitude,i.coords.longitude):(e.mapService.moveMapsNoAnimation(i.coords.latitude,i.coords.longitude),setTimeout((function(){e.mapService.moveMapsLatLng(i.coords.latitude,i.coords.longitude)}),1e3)))})).catch((function(e){t.dismiss(),console.log("Error getting location",e)}))},t.prototype.watchLocation=function(){var t=this,e=this.geolocation.watchPosition({enableHighAccuracy:!0});this.watchSubscription=e.subscribe((function(e){if(e&&e.coords){var i=new Date;if((!t.currentPositionTracked||i.getTime()-t.currentPositionTracked.getTime()>2e3)&&(t.mapService.updateCurrentPosition({latitude:e.coords.latitude,longitude:e.coords.longitude}),t.mapService.moveMapsLatLng(e.coords.latitude,e.coords.longitude),t.currentPositionTracked=i),!t.trackedPositionTracked||i.getTime()-t.trackedPositionTracked.getTime()>1e4){var n=t.mapService.convertLatLng({latitude:e.coords.latitude,longitude:e.coords.longitude});t.trackedCoordinates.push({latitude:n[0],longitude:n[1]}),t.mapService.addTrackedPosition({latitude:e.coords.latitude,longitude:e.coords.longitude}),t.trackedPositionTracked=i}}}))},t.prototype.stopWatchLocation=function(){this.watchSubscription&&this.watchSubscription.unsubscribe()},t.prototype.toggleLayerVisibility=function(t,e){e.preventDefault(),e.stopPropagation(),t.visible=!t.visible,t.visible?this.mapService.showLayer(t):this.mapService.hideLayer(t)},t.prototype.toggleTrackVisibility=function(t,e){e.preventDefault(),e.stopPropagation(),t.visible=!t.visible,t.visible?this.mapService.showTrack(t):this.mapService.hideTrack(t)},t.prototype.togglePlacemarkVisibility=function(t,e){e.preventDefault(),e.stopPropagation(),t.visible=!t.visible,t.visible?this.mapService.showPlacemark(t):this.mapService.hidePlacemark(t)},t.prototype.getLayers=function(){var t=this;this.layerService.getDefaultLayers().then((function(e){t.defaultLayers=e})),this.layerService.getPrivateLayers().then((function(e){t.privateLayers=e}))},t.prototype.getGroupLayers=function(){var t=this;this.layerService.getGroupLayers(this.currentGroup.id).then((function(e){t.groupLayers=e}))},t.prototype.openProfile=function(){return Object(s.a)(this,void 0,void 0,(function(){var t;return Object(s.c)(this,(function(e){switch(e.label){case 0:return[4,this.modalController.create({component:u.a,componentProps:{profile:this.user.id}})];case 1:return(t=e.sent()).onDidDismiss().then((function(t){})),[4,t.present()];case 2:return e.sent(),[2]}}))}))},t.prototype.openLogs=function(){return Object(s.a)(this,void 0,void 0,(function(){var t;return Object(s.c)(this,(function(e){switch(e.label){case 0:return[4,this.modalController.create({component:b.a,componentProps:{}})];case 1:return(t=e.sent()).onDidDismiss().then((function(t){})),[4,t.present()];case 2:return e.sent(),[2]}}))}))},t.prototype.openSearch=function(){return Object(s.a)(this,void 0,void 0,(function(){var t;return Object(s.c)(this,(function(e){switch(e.label){case 0:return[4,this.modalController.create({component:h.a,componentProps:{search:this.search}})];case 1:return(t=e.sent()).onDidDismiss().then((function(t){})),[4,t.present()];case 2:return e.sent(),[2]}}))}))},t.prototype.openGroups=function(){return Object(s.a)(this,void 0,void 0,(function(){var t,e=this;return Object(s.c)(this,(function(i){switch(i.label){case 0:return[4,this.modalController.create({component:d.a,componentProps:{}})];case 1:return(t=i.sent()).onDidDismiss().then((function(t){var i,n;if(t&&t.data&&t.data.selectedLayer)try{for(var o=Object(s.d)(e.groupLayers),r=o.next();!r.done;r=o.next()){var a=r.value;a.id===t.data.selectedLayer.layer_id&&e.viewLayer(a)}}catch(c){i={error:c}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}})),[4,t.present()];case 2:return i.sent(),[2]}}))}))},t.prototype.openLayers=function(){this.mapLayersOpened=!this.mapLayersOpened},t.prototype.viewLayer=function(t){var e,i,n=this;if(this.showLayer=!0,this.currentLayer=t,this.currentLayer.layer_items=[],this.currentLayer.layer_items=this.currentLayer.layer_items.concat(this.currentLayer.tracks),this.currentLayer.layer_items=this.currentLayer.layer_items.concat(this.currentLayer.placemarks),this.currentLayer.layer_items.length>0)try{for(var o=Object(s.d)(this.currentLayer.layer_items),r=o.next();!r.done;r=o.next()){var a=r.value;if(a.point_type){this.mapService.moveMaps(a.latitude,a.longitude);break}if(a.points&&a.points.length>0){this.mapService.moveMaps(a.points[0].latitude,a.points[0].longitude);break}}}catch(c){e={error:c}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}this.layerService.getOfflinePlacemarks().then((function(t){n.currentLayer.layer_items.concat(t)})).catch((function(){})),this.layerService.getOfflineTracks().then((function(t){n.currentLayer.layer_items.concat(t)})).catch((function(){}))},t.prototype.shareLayer=function(t){this.socialSharing.share("https://www.my-outdoors.co.nz/layer/"+t.id,t.name,null,"https://www.my-outdoors.co.nz/layer/"+t.id).then((function(t){}),(function(t){}))},t.prototype.editLayer=function(t){return Object(s.a)(this,void 0,void 0,(function(){var e,i,n=this;return Object(s.c)(this,(function(o){switch(o.label){case 0:return e={},Object.assign(e,t),[4,this.modalController.create({component:f.a,componentProps:{layer:e}})];case 1:return(i=o.sent()).onDidDismiss().then((function(e){e&&e.data&&(Object.assign(t,e.data.layer),n.layerService.updateLayer(e.data.layer).then((function(){})))})),[4,i.present()];case 2:return o.sent(),[2]}}))}))},t.prototype.showUpgrade=function(){return Object(s.a)(this,void 0,void 0,(function(){var t,e=this;return Object(s.c)(this,(function(i){switch(i.label){case 0:return this.showingUpgrade?[2]:(this.showingUpgrade=!0,[4,this.modalController.create({component:m.a,componentProps:{}})]);case 1:return(t=i.sent()).onDidDismiss().then((function(t){e.showingUpgrade=!1,t&&t.data?e.billingService.upgrade(t.data.id).then((function(t){e.showToast("Thank you! Your account has been upgraded.")})).catch((function(){e.showToast("There was an error. Please try again."),e.showUpgrade()})):e.showUpgrade()})),[4,t.present()];case 2:return i.sent(),[2]}}))}))},t.prototype.showToast=function(t){return Object(s.a)(this,void 0,void 0,(function(){return Object(s.c)(this,(function(e){switch(e.label){case 0:return[4,this.toastController.create({message:t,duration:1e4})];case 1:return e.sent().present(),[2]}}))}))},t.prototype.toggleTracking=function(){return Object(s.a)(this,void 0,void 0,(function(){var t,e=this;return Object(s.c)(this,(function(i){switch(i.label){case 0:return this.isTracking?[3,3]:[4,this.alertController.create({cssClass:"my-custom-class",header:"Start Tracking",message:"You are about to start tracking your location via GPS. Are you sure you want to continue?",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(t){}},{text:"Yes",handler:function(){e.isTracking=!0,e.watchLocation()}}]})];case 1:return[4,i.sent().present()];case 2:return i.sent(),[3,6];case 3:return this.isTracking=!1,this.stopWatchLocation(),[4,this.modalController.create({component:_.a,componentProps:{distance:0}})];case 4:return(t=i.sent()).onDidDismiss().then((function(t){if(t&&t.data){var i=t.data.track;i.points=e.trackedCoordinates,e.layerService.createTrack(i).then((function(t){e.getLayers(),e.getGroupLayers(),e.mapService.showTrack(t),e.trackedCoordinates=[],e.mapService.vectorSource.clear()}))}})),[4,t.present()];case 5:i.sent(),i.label=6;case 6:return[2]}}))}))},t.prototype.updateOpacity=function(t){var e=this;"Weather"===this.mapTypes[t].name&&(this.windyOpacity=this.mapTypes[t].visible?this.mapTypes[t].opacity:0,this.mapService.windyVisibility=this.windyOpacity),this.map.getLayers().forEach((function(i,n){n===t+1&&i.setOpacity(e.mapTypes[t].opacity)}))},t.prototype.setVisibility=function(t){var e=this;this.mapTypes[t].visible=!this.mapTypes[t].visible,"Weather"===this.mapTypes[t].name&&(this.windyOpacity=this.mapTypes[t].visible?this.mapTypes[t].opacity:0,this.mapService.windyVisibility=this.windyOpacity),this.map.getLayers().forEach((function(i,n){n===t+1&&i.setVisible(e.mapTypes[t].visible)}))},t.prototype.setMapEvents=function(){var t=this;this.map.on("click",(function(e){t.map.forEachFeatureAtPixel(e.pixel,(function(i,n){e.preventDefault();var o=i.getId();if(o){var r=o.split("-"),a=r[0],s=parseInt(r[1]);if(s&&!isNaN(s)){var c=t.getItemFromId(a,s);t.viewItem(c)}}}))})),this.map.on("pointerdrag",(function(e){t.recenterActive=!0}))},t.prototype.getItemFromId=function(t,e){var i,n,o,r,a,c,p,l,h,d,u,m;try{for(var f=Object(s.d)(this.defaultLayers),_=f.next();!_.done;_=f.next()){var b=_.value;try{for(var y=(o=void 0,Object(s.d)(b[t+"s"])),g=y.next();!g.done;g=y.next())if((S=g.value).id===e)return S}catch(T){o={error:T}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(o)throw o.error}}}}catch(I){i={error:I}}finally{try{_&&!_.done&&(n=f.return)&&n.call(f)}finally{if(i)throw i.error}}try{for(var v=Object(s.d)(this.privateLayers),k=v.next();!k.done;k=v.next()){b=k.value;try{for(var C=(p=void 0,Object(s.d)(b[t+"s"])),w=C.next();!w.done;w=C.next())if((S=w.value).id===e)return S}catch(j){p={error:j}}finally{try{w&&!w.done&&(l=C.return)&&l.call(C)}finally{if(p)throw p.error}}}}catch(F){a={error:F}}finally{try{k&&!k.done&&(c=v.return)&&c.call(v)}finally{if(a)throw a.error}}try{for(var x=Object(s.d)(this.groupLayers),L=x.next();!L.done;L=x.next()){b=L.value;try{for(var O=(u=void 0,Object(s.d)(b[t+"s"])),P=O.next();!P.done;P=O.next()){var S;if((S=P.value).id===e)return S}}catch(D){u={error:D}}finally{try{P&&!P.done&&(m=O.return)&&m.call(O)}finally{if(u)throw u.error}}}}catch(J){h={error:J}}finally{try{L&&!L.done&&(d=x.return)&&d.call(x)}finally{if(h)throw h.error}}return{color:"#ff7f00"}},t.prototype.viewItem=function(t){t.point_type?(this.viewPlacemark(t),this.mapService.moveMaps(t.latitude,t.longitude)):t.id&&(this.viewTrack(t),t.points&&t.points.length>0&&this.mapService.moveMaps(t.points[0].latitude,t.points[0].longitude))},t.prototype.viewTrack=function(t){return Object(s.a)(this,void 0,void 0,(function(){var e,i=this;return Object(s.c)(this,(function(n){switch(n.label){case 0:return[4,this.modalController.create({component:c.a,componentProps:{track:t}})];case 1:return(e=n.sent()).onDidDismiss().then((function(e){if(e&&e.data){var n=e.data.track;if(n.edited){var o=t.color;Object.assign(t,n),o!==t.color&&(t.visible||i.currentLayer.visible)&&(i.mapService.hideTrack(t),i.mapService.showTrack(t)),i.layerService.updateTrack(n).then((function(){i.getLayers(),i.getGroupLayers()}))}else n.deleted&&i.layerService.deleteTrack(t.id).then((function(){i.mapService.hideTrack(t),i.getLayers(),i.getGroupLayers(),i.showLayer=!1}))}})),[4,e.present()];case 2:return n.sent(),[2]}}))}))},t.prototype.viewPlacemark=function(t){return Object(s.a)(this,void 0,void 0,(function(){var e,i=this;return Object(s.c)(this,(function(n){switch(n.label){case 0:return[4,this.modalController.create({component:p.a,componentProps:{placemark:t}})];case 1:return(e=n.sent()).onDidDismiss().then((function(e){if(e&&e.data){var n=e.data.placemark;if(n.edited){var o=t.color;Object.assign(t,n),o!==t.color&&(t.visible||i.currentLayer.visible)&&(i.mapService.hidePlacemark(t),i.mapService.showPlacemark(t)),i.layerService.updatePlacemark(n).then((function(){i.getLayers(),i.getGroupLayers()}))}else n.deleted&&i.layerService.deletePlacemark(t.id).then((function(){i.mapService.hidePlacemark(t),i.getLayers(),i.getGroupLayers(),i.showLayer=!1}))}})),[4,e.present()];case 2:return n.sent(),[2]}}))}))},t.prototype.dismiss=function(){this.modalController.dismiss()},t.prototype.formatFromNow=function(t){return g(t).from(g())},t.\u0275fac=function(e){return new(e||t)(v.Hb(k.a),v.Hb(r.K),v.Hb(r.a),v.Hb(r.L),v.Hb(C.a),v.Hb(w.a),v.Hb(x.a),v.Hb(r.S),v.Hb(L.a),v.Hb(O.a),v.Hb(P.a),v.Hb(S.a),v.Hb(r.J))},t.\u0275cmp=v.Bb({type:t,selectors:[["app-map"]],decls:81,vars:38,consts:[["main","",1,"map"],["id","windy",1,"map__container","map__container--windy",3,"ngStyle","ngClass"],["id","map-container",1,"map__container"],["mapContainerRef",""],[1,"map__actions"],["shape","round","fill","clear",1,"map__actions__action",3,"click"],["slot","icon-only","name","person"],["slot","icon-only","name","book"],["slot","icon-only","name","search"],["slot","icon-only","name","layers"],["class","map__map-layers-overlay",3,"click",4,"ngIf"],[1,"map__layers",3,"ngClass"],["color","primary"],["slot","start"],[3,"click"],["name","close"],[3,"ngModel","ngModelChange"],["value","myoutdoors"],["value","group",4,"ngIf"],["value","private",4,"ngIf"],[4,"ngIf"],[1,"map__layer",3,"ngClass"],["slot","end"],["class","map__map-types-overlay",3,"click",4,"ngIf"],[1,"map__map-types",3,"ngClass"],["class","map__map-types__map-type",4,"ngFor","ngForOf"],["class","map__recenter",4,"ngIf"],[1,"map__secondary-actions"],["size","small","color","light",3,"ngClass","click"],["name","location"],["name","analytics"],[1,"map__compass"],[1,"map__compass__direction","map__compass__direction--north"],[1,"map__compass__direction","map__compass__direction--east"],[1,"map__compass__direction","map__compass__direction--south"],[1,"map__compass__direction","map__compass__direction--west"],["id","compass-icon","name","navigate-circle","color","light"],["color","primary",1,"map-tabs"],[1,"map-tabs__tab",3,"ngClass","click"],["name","map"],[1,"map-tabs__tab",3,"click"],["name","locate","color","primary"],["name","people"],["id","currentposition"],["name","caret-up","color","light"],[1,"map__map-layers-overlay",3,"click"],["value","group"],["value","private"],[3,"click",4,"ngFor","ngForOf"],["slot","end","fill","clear","color","dark",3,"click"],["slot","icon-only",3,"name"],["name","location","slot","start",4,"ngIf"],["name","analytics","slot","start",4,"ngIf"],["slot","end","fill","clear","color","dark",3,"click",4,"ngIf"],["name","location","slot","start"],["name","analytics","slot","start"],[1,"map__map-types-overlay",3,"click"],[1,"map__map-types__map-type"],[1,"map__map-types__map-type__tile",3,"ngStyle","ngClass","click"],[1,"map__map-types__map-type__slider"],["color","primary","min","0","max","1","step","0.1",3,"id","ngModel","ngModelChange","ionChange"],[1,"map__recenter"],["color","light",3,"click"],["slot","start","name","navigate"]],template:function(t,e){1&t&&(v.Kb(0,"ion-content",0),v.Ib(1,"div",1),v.Ib(2,"div",2,3),v.Kb(4,"div",4),v.Kb(5,"ion-button",5),v.Sb("click",(function(){return e.openProfile()})),v.Ib(6,"ion-icon",6),v.Jb(),v.Kb(7,"ion-button",5),v.Sb("click",(function(){return e.openLogs()})),v.Ib(8,"ion-icon",7),v.Jb(),v.Kb(9,"ion-button",5),v.Sb("click",(function(){return e.openSearch()})),v.Ib(10,"ion-icon",8),v.Jb(),v.Kb(11,"ion-button",5),v.Sb("click",(function(){return e.openLayers()})),v.Ib(12,"ion-icon",9),v.Jb(),v.Jb(),v.kc(13,T,1,0,"div",10),v.Kb(14,"div",11),v.Kb(15,"ion-header"),v.Kb(16,"ion-toolbar",12),v.Kb(17,"ion-buttons",13),v.Kb(18,"ion-button",14),v.Sb("click",(function(){return e.mapLayersOpened=!e.mapLayersOpened})),v.Ib(19,"ion-icon",15),v.Jb(),v.Jb(),v.Kb(20,"ion-title"),v.lc(21,"Layers"),v.Jb(),v.Jb(),v.Jb(),v.Kb(22,"ion-content"),v.Kb(23,"ion-segment",16),v.Sb("ngModelChange",(function(t){return e.activeGroupTab=t})),v.Kb(24,"ion-segment-button",17),v.Kb(25,"ion-label"),v.lc(26,"My Outdoors"),v.Jb(),v.Jb(),v.kc(27,I,3,1,"ion-segment-button",18),v.kc(28,j,3,0,"ion-segment-button",19),v.Jb(),v.kc(29,D,2,1,"ion-list",20),v.kc(30,K,2,1,"ion-list",20),v.kc(31,M,2,1,"ion-list",20),v.Jb(),v.Jb(),v.Kb(32,"div",21),v.Kb(33,"ion-header"),v.Kb(34,"ion-toolbar",12),v.Kb(35,"ion-buttons",13),v.Kb(36,"ion-button",14),v.Sb("click",(function(){return e.showLayer=!e.showLayer})),v.Ib(37,"ion-icon",15),v.Jb(),v.Jb(),v.Kb(38,"ion-title",14),v.Sb("click",(function(){return e.editLayer(e.currentLayer)})),v.lc(39),v.Jb(),v.Kb(40,"ion-buttons",22),v.Kb(41,"ion-button",14),v.Sb("click",(function(){return e.shareLayer(e.currentLayer)})),v.lc(42," Share "),v.Jb(),v.Jb(),v.Jb(),v.Jb(),v.Kb(43,"ion-content"),v.kc(44,V,2,1,"ion-list",20),v.Jb(),v.Jb(),v.kc(45,H,1,0,"div",23),v.Kb(46,"div",24),v.kc(47,$,6,9,"div",25),v.Jb(),v.kc(48,q,4,0,"div",26),v.Kb(49,"div",27),v.Kb(50,"ion-fab-button",28),v.Sb("click",(function(){return e.addPlacemark()})),v.Ib(51,"ion-icon",29),v.Jb(),v.Kb(52,"ion-fab-button",28),v.Sb("click",(function(){return e.addTrack()})),v.Ib(53,"ion-icon",30),v.Jb(),v.Jb(),v.Kb(54,"div",31),v.Kb(55,"div",32),v.lc(56,"N"),v.Jb(),v.Kb(57,"div",33),v.lc(58,"E"),v.Jb(),v.Kb(59,"div",34),v.lc(60,"S"),v.Jb(),v.Kb(61,"div",35),v.lc(62,"W"),v.Jb(),v.Ib(63,"ion-icon",36),v.Jb(),v.Jb(),v.Kb(64,"ion-footer"),v.Kb(65,"ion-segment",37),v.Kb(66,"ion-segment-button",38),v.Sb("click",(function(){return e.mapTypesOpened=!e.mapTypesOpened})),v.Ib(67,"ion-icon",39),v.Kb(68,"ion-label"),v.lc(69,"Maps"),v.Jb(),v.Jb(),v.Kb(70,"ion-segment-button",40),v.Sb("click",(function(){return e.toggleTracking()})),v.Ib(71,"ion-icon",41),v.Kb(72,"ion-label"),v.kc(73,W,2,0,"span",20),v.kc(74,B,2,0,"span",20),v.Jb(),v.Jb(),v.Kb(75,"ion-segment-button",40),v.Sb("click",(function(){return e.openGroups()})),v.Ib(76,"ion-icon",42),v.Kb(77,"ion-label"),v.lc(78,"Groups"),v.Jb(),v.Jb(),v.Jb(),v.Jb(),v.Kb(79,"div",43),v.Ib(80,"ion-icon",44),v.Jb()),2&t&&(v.xb(1),v.Xb("ngStyle",v.ac(22,Q,e.windyOpacity?e.windyOpacity:0))("ngClass",v.ac(24,Z,e.windyOpacity>0)),v.xb(12),v.Xb("ngIf",e.showLayer||e.mapLayersOpened),v.xb(1),v.Xb("ngClass",v.ac(26,tt,e.mapLayersOpened)),v.xb(9),v.Xb("ngModel",e.activeGroupTab),v.xb(4),v.Xb("ngIf",e.currentGroup&&e.currentGroup.id),v.xb(1),v.Xb("ngIf",!e.currentGroup.id),v.xb(1),v.Xb("ngIf","myoutdoors"===e.activeGroupTab),v.xb(1),v.Xb("ngIf","group"===e.activeGroupTab),v.xb(1),v.Xb("ngIf","private"===e.activeGroupTab),v.xb(1),v.Xb("ngClass",v.ac(28,et,e.showLayer)),v.xb(7),v.mc(e.currentLayer.name),v.xb(5),v.Xb("ngIf",e.currentLayer.layer_items),v.xb(1),v.Xb("ngIf",e.mapTypesOpened),v.xb(1),v.Xb("ngClass",v.ac(30,it,e.mapTypesOpened)),v.xb(1),v.Xb("ngForOf",e.mapTypes),v.xb(1),v.Xb("ngIf",e.recenterActive),v.xb(2),v.Xb("ngClass",v.ac(32,nt,e.enableAddPlacemark)),v.xb(2),v.Xb("ngClass",v.ac(34,nt,e.enableAddTrack)),v.xb(14),v.Xb("ngClass",v.ac(36,ot,e.mapTypesOpened)),v.xb(7),v.Xb("ngIf",!e.isTracking),v.xb(1),v.Xb("ngIf",e.isTracking))},directives:[r.k,n.k,n.h,r.g,r.p,n.j,r.o,r.G,r.h,r.F,r.z,r.Q,o.d,o.g,r.A,r.t,n.i,r.m,r.n,r.u,r.r,r.w],styles:['.map{--overflow:hidden}.map .map__container{width:100%;height:100vh;position:absolute;left:0;top:0;z-index:2}.map .map__container.map__container--windy{z-index:1;opacity:.5}.map .map__container.map__container--windy #mobile-ovr-select{right:70px!important}.map .map__container.map__container--windy #logo{top:5px!important;margin-top:0!important;left:10px!important}.map .map__container.map__container--windy #bottom{bottom:70px}.map .map__container.map__container--windy #bottom #accumulations,.map .map__container.map__container--windy #embed-zoom{display:none}.map .map__container.map__container--windy-visible{z-index:3}.map .map__container .ol-rotate,.map .map__container .ol-zoom{display:none}.map .map__container .ol-attribution{opacity:0}.map .map__container .ol-overlaycontainer-stopevent{display:none}.map .map__secondary-actions{position:absolute;z-index:4;bottom:15px;right:5px}.map .map__secondary-actions ion-fab-button{margin-top:15px;--ion-color-contrast:#ff7f00!important}.map .map__secondary-actions ion-fab-button.active{--ion-color-base:#dadada!important}.map .map__compass{position:absolute;left:20px;top:20px;z-index:2}.map .map__compass .map__compass__direction{color:#fff;position:absolute;width:100%;font-size:10px}.map .map__compass .map__compass__direction.map__compass__direction--north{top:-14px;left:0;text-align:center}.map .map__compass .map__compass__direction.map__compass__direction--east{top:14px;right:-10px;text-align:right}.map .map__compass .map__compass__direction.map__compass__direction--south{bottom:-11px;left:0;text-align:center}.map .map__compass .map__compass__direction.map__compass__direction--west{top:14px;left:-13px;text-align:left}.map .map__compass ion-icon{width:40px;height:40px;transform:rotate(-45deg)}.map .map__actions{position:absolute;right:10px;top:10px;z-index:4;background-color:#fff;padding:6px;border-radius:6px}.map .map__actions .map__actions__action{display:block;font-size:12px;width:36px;height:36px;--padding-start:0px;--padding-end:0px}.map .map__actions .map__actions__action:not(:last-child){margin-bottom:15px}.map .map__actions .map__actions__action .button-native{padding:0}.map .map__map-layers-overlay{width:100%;height:100%;position:absolute;top:0;left:0;z-index:3}.map .map__layers{width:300px;position:absolute;right:-300px;top:0;height:100%;z-index:9;transition:right .2s ease-in;display:flex;flex-direction:column}.map .map__layers.map__layers--opened{right:0}.map .map__layers ion-content{flex:1}.map .map__layer{width:300px;position:absolute;right:-300px;top:0;height:100%;z-index:10;transition:right .2s ease-in;display:flex;flex-direction:column}.map .map__layer.map__layer--opened{right:0}.map .map__layer ion-content{flex:1}.map .map__map-types-overlay{width:100%;height:100%;position:absolute;top:0;left:0;z-index:3}.map .map__map-types{position:absolute;left:0;z-index:5;background-color:#fff;bottom:-300px;transition:bottom .2s ease-in;width:100%;padding:20px 10px}.map .map__map-types.map__map-types--opened{bottom:0}.map .map__map-types .map__map-types__map-type{display:flex;align-items:center;margin-bottom:5px;position:relative}.map .map__map-types .map__map-types__map-type .map__map-types__map-type__tile{background-color:#fff;width:60px;height:60px;border-radius:5px;position:relative;overflow:hidden;background-size:cover;background-position:50%;cursor:pointer;display:inline-block}.map .map__map-types .map__map-types__map-type .map__map-types__map-type__tile.map__map-types__map-type__tile--selected:after{content:"";position:absolute;left:0;top:0;width:calc(100% - 2px);height:calc(100% - 2px);border:1px solid #ff7f00;border-radius:5px}.map .map__map-types .map__map-types__map-type .map__map-types__map-type__tile span{background-color:rgba(0,0,0,.7);color:#fff;position:absolute;bottom:0;left:0;padding:3px;font-size:9px;width:100%;text-align:center;display:block}.map .map__map-types .map__map-types__map-type .map__map-types__map-type__slider{display:inline-block;flex:1;--border-color:transparent;overflow:visible}.map .map__map-types .map__map-types__map-type .map__map-types__map-type__slider ion-range{padding:0;overflow:visible}.map .map__map-types .map__map-types__map-type .map__map-types__map-type__slider ion-range .range-slider{overflow:visible}.map__recenter{z-index:3;position:absolute;bottom:10px;left:0;width:100%;text-align:center}.map__recenter ion-button{--ion-color-contrast:#ff7f00!important}.map-tabs .map-tabs__tab{--indicator-height:0px}.map-tabs .map-tabs__tab.segment-button-checked --color-checked,.map-tabs .map-tabs__tab.segment-button-checked ion-icon,.map-tabs .map-tabs__tab.segment-button-checked ion-label,.map-tabs .map-tabs__tab ion-icon,.map-tabs .map-tabs__tab ion-label{color:#666}.map-tabs .map-tabs__tab.map-tabs__tab--opened ion-icon,.map-tabs .map-tabs__tab.map-tabs__tab--opened ion-label{color:#ff7f00}#compass-icon,#currentposition{transform-origin:center;transition:transform .2s ease}#currentposition{width:15px;height:15px;background-color:#fff;border-radius:7.5px;border:2px solid #ff7f00;overflow:visible;position:absolute;display:block}#currentposition ion-icon{position:absolute;font-size:20px;width:18px;height:18px;top:-19px;left:-3.5px}'],encapsulation:2}),t}()}],at=function(){function t(){}return t.\u0275mod=v.Fb({type:t}),t.\u0275inj=v.Eb({factory:function(e){return new(e||t)},imports:[[a.j.forChild(rt)],a.j]}),t}(),st=function(){function t(){}return t.\u0275mod=v.Fb({type:t}),t.\u0275inj=v.Eb({factory:function(e){return new(e||t)},imports:[[n.b,o.a,r.H,at]]}),t}()},rCk2:function(t,e,i){"use strict";var n,o=i("AdTM"),r=i("TN97"),a=i("Cy2j"),s=i("3kY4"),c=i("4mld"),p=i("pWiS"),l=i("zvco"),h=i("Bviv"),d=i("CvXi"),u=i("V8uu"),m=i("9iPr"),f=i("mrzG"),_=i("q7cr"),b=i("vvg4"),y=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),g=function(t){function e(e,i,n){var o=t.call(this)||this;return void 0!==n&&void 0===i?o.setFlatCoordinates(n,e):o.setCenterAndRadius(e,i||0,n),o}return y(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),void 0,this.layout)},e.prototype.closestPointXY=function(t,e,i,n){var o=this.flatCoordinates,r=t-o[0],a=e-o[1],s=r*r+a*a;if(s<n){if(0===s)for(var c=0;c<this.stride;++c)i[c]=o[c];else{var p=this.getRadius()/Math.sqrt(s);for(i[0]=o[0]+p*r,i[1]=o[1]+p*a,c=2;c<this.stride;++c)i[c]=o[c]}return i.length=this.stride,s}return n},e.prototype.containsXY=function(t,e){var i=this.flatCoordinates,n=t-i[0],o=e-i[1];return n*n+o*o<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,i=e[this.stride]-e[0];return Object(d.k)(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return m.a.CIRCLE},e.prototype.intersectsExtent=function(t){var e=this.getExtent();if(Object(d.F)(t,e)){var i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]||Object(d.t)(t,this.intersectsCoordinate.bind(this))}return!1},e.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(var o=1;o<e;++o)n[e+o]=t[o];this.setFlatCoordinates(this.layout,n),this.changed()},e.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var n=this.flatCoordinates,o=Object(_.a)(n,0,t,this.stride);n[o++]=n[0]+e;for(var r=1,a=this.stride;r<a;++r)n[o++]=n[r];n.length=o,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e.prototype.rotate=function(t,e){var i=this.getCenter(),n=this.getStride();this.setCenter(Object(b.a)(i,0,i.length,n,t,e,i)),this.changed()},e.prototype.translate=function(t,e){var i=this.getCenter(),n=this.getStride();this.setCenter(Object(b.d)(i,0,i.length,n,t,e,i)),this.changed()},e}(f.a),v=i("egkh"),k=i("n15R"),C=i("Uhtb"),w=i("l2lA"),x=i("u2yf"),L=i("saKC"),O=i("xWBw"),P=i("HEh+"),S=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),T=function(t){function e(e,i,n){var o=t.call(this)||this;if(o.ends_=[],o.maxDelta_=-1,o.maxDeltaRevision_=-1,Array.isArray(e[0]))o.setCoordinates(e,i);else if(void 0!==i&&n)o.setFlatCoordinates(i,e),o.ends_=n;else{for(var r=o.getLayout(),a=e,s=[],c=[],p=0,l=a.length;p<l;++p){var h=a[p];0===p&&(r=h.getLayout()),Object(k.c)(s,h.getFlatCoordinates()),c.push(s.length)}o.setFlatCoordinates(r,s),o.ends_=c}return o}return S(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?Object(k.c)(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,i,n){return n<Object(d.e)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(w.a)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(w.b)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))},e.prototype.getCoordinateAtM=function(t,e,i){if(this.layout!=C.a.XYM&&this.layout!=C.a.XYZM||0===this.flatCoordinates.length)return null;var n=void 0!==e&&e,o=void 0!==i&&i;return Object(L.c)(this.flatCoordinates,0,this.ends_,this.stride,t,n,o)},e.prototype.getCoordinates=function(){return Object(x.b)(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new v.a(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[],o=0,r=0,a=e.length;r<a;++r){var s=e[r],c=new v.a(t.slice(o,s),i);n.push(c),o=s}return n},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,n=this.ends_,o=this.stride,r=0,a=n.length;r<a;++r){var s=n[r],c=Object(L.a)(e,i,s,o,.5);Object(k.c)(t,c),i=s}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=Object(P.b)(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,n),new e(i,C.a.XY,n)},e.prototype.getType=function(){return m.a.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return Object(O.b)(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=Object(_.c)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(f.a),I=i("9ANI"),j=i("f8l7"),F=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),D=function(t){function e(e,i){var n=t.call(this)||this;return i&&!Array.isArray(e[0])?n.setFlatCoordinates(i,e):n.setCoordinates(e,i),n}return F(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?Object(k.c)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,n){if(n<Object(d.e)(this.getExtent(),t,e))return n;for(var o=this.flatCoordinates,r=this.stride,a=0,s=o.length;a<s;a+=r){var c=Object(j.f)(t,e,o[a],o[a+1]);if(c<n){n=c;for(var p=0;p<r;++p)i[p]=o[a+p];i.length=r}}return n},e.prototype.getCoordinates=function(){return Object(x.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){return t<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=t?null:new I.a(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,n=[],o=0,r=t.length;o<r;o+=i){var a=new I.a(t.slice(o,o+i),e);n.push(a)}return n},e.prototype.getType=function(){return m.a.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,n=0,o=e.length;n<o;n+=i){var r=e[n],a=e[n+1];if(Object(d.h)(t,r,a))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Object(_.b)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(f.a),J=i("W8M7"),K=i("tYnX"),G=i("JfHk"),M=i("Cp04"),E=i("TZgD"),A=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),X=function(t){function e(e,i,n){var o=t.call(this)||this;if(o.endss_=[],o.flatInteriorPointsRevision_=-1,o.flatInteriorPoints_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){for(var r=o.getLayout(),a=e,s=[],c=[],p=0,l=a.length;p<l;++p){var h=a[p];0===p&&(r=h.getLayout());for(var d=s.length,u=h.getEnds(),m=0,f=u.length;m<f;++m)u[m]+=d;Object(k.c)(s,h.getFlatCoordinates()),c.push(u)}i=r,e=s,n=c}return void 0!==i&&n?(o.setFlatCoordinates(i,e),o.endss_=n):o.setCoordinates(e,i),o}return A(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;Object(k.c)(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,o=(e=t.getEnds().slice()).length;n<o;++n)e[n]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,i=new Array(t),n=0;n<t;++n)i[n]=this.endss_[n].slice();return new e(this.flatCoordinates.slice(),this.layout,i)},e.prototype.closestPointXY=function(t,e,i,n){return n<Object(d.e)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(w.f)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(w.c)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,n))},e.prototype.containsXY=function(t,e){return Object(G.d)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return Object(K.c)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Object(E.d)(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Object(x.c)(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,i,n){for(var o=[],r=Object(d.j)(),a=0,s=i.length;a<s;++a){var c=i[a];r=Object(d.o)(t,e,c[0],n),o.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=c[c.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Object(M.b)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new D(this.getFlatInteriorPoints().slice(),C.a.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Object(E.b)(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Object(E.d)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=Object(P.d)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,n),new e(i,C.a.XY,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var n=this.endss_[t].slice(),o=n[n.length-1];if(0!==e)for(var r=0,a=n.length;r<a;++r)n[r]-=e;return new J.a(this.flatCoordinates.slice(e,o),this.layout,n)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[],o=0,r=0,a=i.length;r<a;++r){var s=i[r].slice(),c=s[s.length-1];if(0!==o)for(var p=0,l=s.length;p<l;++p)s[p]-=o;var h=new J.a(e.slice(o,c),t,s);n.push(h),o=c}return n},e.prototype.getType=function(){return m.a.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return Object(O.d)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=Object(_.d)(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var n=i[i.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},e}(f.a),R=i("QQWy"),U=i("v2Km"),N=i("Pmt0"),V=i("WDFe"),H=i("bHcU"),z=i("JW8z"),Y=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$=function(t){function e(e,i){var n=t.call(this,e)||this;return n.feature=i,n}return Y(e,t),e}(l.a),q=function(t){function e(e){var i,n,o=this,r=e;r.stopDown||(r.stopDown=u.a),(o=t.call(this,r)||this).shouldHandle_=!1,o.downPx_=null,o.freehand_=!1,o.source_=e.source?e.source:null,o.features_=e.features?e.features:null,o.snapTolerance_=e.snapTolerance?e.snapTolerance:12,o.type_=e.type,o.mode_=((i=o.type_)===m.a.POINT||i===m.a.MULTI_POINT?n="Point":i===m.a.LINE_STRING||i===m.a.MULTI_LINE_STRING?n="LineString":i===m.a.POLYGON||i===m.a.MULTI_POLYGON?n="Polygon":i===m.a.CIRCLE&&(n="Circle"),n),o.stopClick_=!!e.stopClick,o.minPoints_=e.minPoints?e.minPoints:"Polygon"===o.mode_?3:2,o.maxPoints_=e.maxPoints?e.maxPoints:1/0,o.finishCondition_=e.finishCondition?e.finishCondition:u.b;var a,s=e.geometryFunction;if(!s)if(o.type_===m.a.CIRCLE)s=function(t,e,i){var n=e||new g([NaN,NaN]),o=Object(z.e)(t[0],i),r=Object(p.e)(o,Object(z.e)(t[1],i));n.setCenterAndRadius(o,Math.sqrt(r));var a=Object(z.k)();return a&&n.transform(i,a),n};else{var l,d=o.mode_;"Point"===d?l=I.a:"LineString"===d?l=v.a:"Polygon"===d&&(l=J.a),s=function(t,e,i){var n=e;return n?n.setCoordinates("Polygon"===d?t[0].length?[t[0].concat([t[0][0]])]:[]:t):n=new l(t),n}}return o.geometryFunction_=s,o.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,o.finishCoordinate_=null,o.sketchFeature_=null,o.sketchPoint_=null,o.sketchCoords_=null,o.sketchLine_=null,o.sketchLineCoords_=null,o.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,o.overlay_=new N.a({source:new V.a({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(a=Object(H.b)(),function(t,e){return a[t.getGeometry().getType()]}),updateWhileInteracting:!0}),o.geometryName_=e.geometryName,o.condition_=e.condition?e.condition:h.f,o.freehandCondition_=e.freehand?h.b:e.freehandCondition?e.freehandCondition:h.h,o.addEventListener(Object(c.b)(U.a.ACTIVE),o.updateState_),o}return Y(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===o.a.CONTEXTMENU&&e.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);var i=e.type===a.a.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===a.a.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,i=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===a.a.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===a.a.POINTERDOWN?n=!1:i?(n=e.type===a.a.POINTERMOVE)&&this.freehand_?n=this.handlePointerMove_(e):("mouse"==e.pointerEvent.pointerType||e.type===a.a.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===a.a.DBLCLICK&&(n=!1),t.prototype.handleEvent.call(this,e)&&n},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((function(){this.handlePointerMove_(new s.a(a.a.POINTERMOVE,t.map,t.pointerEvent,!1,t.frameState))}).bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},e.prototype.handleUpEvent=function(t){var e=!0;return this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t),this.shouldHandle_?(this.finishCoordinate_?this.freehand_||"Circle"===this.mode_?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate):(this.startDrawing_(t),"Point"===this.mode_&&this.finishDrawing()),e=!1):this.freehand_&&this.abortDrawing(),!e&&this.stopClick_&&t.stopPropagation(),e},e.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,n=e[0]-i[0],o=e[1]-i[1],r=n*n+o*o;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t),!0},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,n=[this.finishCoordinate_];if("LineString"===this.mode_)i=this.sketchCoords_.length>this.minPoints_;else if("Polygon"===this.mode_){var o=this.sketchCoords_;i=o[0].length>this.minPoints_,n=[o[0][0],o[0][o[0].length-2]]}if(i)for(var r=t.map,a=0,s=n.length;a<s;a++){var c=n[a],p=r.getPixelFromCoordinate(c),l=t.pixel,h=l[0]-p[0],d=l[1]-p[1],u=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(h*h+d*d)<=u){this.finishCoordinate_=c;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new r.a(new I.a(e)),this.updateSketchFeatures_())},e.prototype.startDrawing_=function(t){var e=t.coordinate,i=t.map.getView().getProjection();this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new r.a(new v.a(this.sketchLineCoords_)));var n=this.geometryFunction_(this.sketchCoords_,void 0,i);this.sketchFeature_=new r.a,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new $("drawstart",this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,i,n,o=t.coordinate,a=this.sketchFeature_.getGeometry(),s=t.map.getView().getProjection();if("Point"===this.mode_?i=this.sketchCoords_:"Polygon"===this.mode_?(i=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(o=this.finishCoordinate_.slice())):i=(e=this.sketchCoords_)[e.length-1],i[0]=o[0],i[1]=o[1],this.geometryFunction_(this.sketchCoords_,a,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(o),a.getType()==m.a.POLYGON&&"Polygon"!==this.mode_){this.sketchLine_||(this.sketchLine_=new r.a);var c=a.getLinearRing(0);(n=this.sketchLine_.getGeometry())?(n.setFlatCoordinates(c.getLayout(),c.getFlatCoordinates()),n.changed()):(n=new v.a(c.getFlatCoordinates(),c.getLayout()),this.sketchLine_.setGeometry(n))}else this.sketchLineCoords_&&(n=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,i,n=this.sketchFeature_.getGeometry(),o=this.getMap().getView().getProjection();"LineString"===this.mode_?(this.finishCoordinate_=t.slice(),(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),this.geometryFunction_(i,n,o)):"Polygon"===this.mode_&&((i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),e&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,n,o)),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();"LineString"===this.mode_?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e,i),t.length>=2&&(this.finishCoordinate_=t[t.length-2].slice())):"Polygon"===this.mode_&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,i)),0===t.length&&this.abortDrawing(),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry(),n=this.getMap().getView().getProjection();"LineString"===this.mode_?(e.pop(),this.geometryFunction_(e,i,n)):"Polygon"===this.mode_&&(e[0].pop(),this.geometryFunction_(e,i,n),e=i.getCoordinates()),this.type_===m.a.MULTI_POINT?t.setGeometry(new D([e])):this.type_===m.a.MULTI_LINE_STRING?t.setGeometry(new T([e])):this.type_===m.a.MULTI_POLYGON&&t.setGeometry(new X([e])),this.dispatchEvent(new $("drawend",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),t},e.prototype.abortDrawing=function(){var t=this.abortDrawing_();t&&this.dispatchEvent(new $("drawabort",t))},e.prototype.appendCoordinates=function(t){var e=this.mode_,i=[];"LineString"===e?i=this.sketchCoords_:"Polygon"===e&&(i=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]);for(var n=i.pop(),o=0;o<t.length;o++)this.addToDrawing_(t[o]);this.addToDrawing_(n)},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new $("drawstart",this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing(),this.overlay_.setMap(e?t:null)},e}(R.b);e.a=q}}]);