(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{IYJ9:function(t,n,o){"use strict";o.d(n,"a",(function(){return r}));var e=o("AytR"),i=o("fXoL"),c=o("tk/3"),s=o("e8h1"),r=function(){function t(t,n){this.http=t,this.storage=n}return t.prototype.upgrade=function(t){var n=this;return new Promise((function(o,i){n.storage.get("go_token").then((function(c){c?n.http.post(e.a.apiUrl+"/subscriptions/start?token="+c,{id:t}).subscribe((function(t){o(t)}),(function(t){i(t)})):i()}))}))},t.prototype.cancel=function(){var t=this;return new Promise((function(n,o){t.storage.get("go_token").then((function(i){i?t.http.post(e.a.apiUrl+"/subscriptions/cancel?token="+i,{}).subscribe((function(t){n(t)}),(function(t){o(t)})):o()}))}))},t.prototype.getInvoices=function(){var t=this;return new Promise((function(n,o){t.storage.get("go_token").then((function(i){i?t.http.get(e.a.apiUrl+"/invoices?token="+i).subscribe((function(t){n(t)}),(function(t){o(t)})):o()}))}))},t.prototype.getInvoice=function(t){var n=this;return new Promise((function(o,i){n.storage.get("go_token").then((function(c){c?n.http.get(e.a.apiUrl+"/invoices/"+t+"?token="+c).subscribe((function(t){o(t)}),(function(t){i(t)})):i()}))}))},t.\u0275fac=function(n){return new(n||t)(i.Ob(c.a),i.Ob(s.b))},t.\u0275prov=i.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},OAiQ:function(t,n,o){"use strict";o.d(n,"a",(function(){return m}));var e=o("mrSG"),i=o("wd/R"),c=o("AytR"),s=o("fXoL"),r=o("IYJ9"),a=o("TEn/"),l=o("ri4K"),u=o("m/P+"),b=o("e8h1"),p=o("ofXK");function f(t,n){1&t&&s.Ib(0,"ion-spinner",9)}function h(t,n){if(1&t){var o=s.Lb();s.Kb(0,"ion-button",7),s.Sb("click",(function(){return s.ec(o),s.Ub().cancelSubscription()})),s.lc(1," Cancel Subscription "),s.kc(2,f,1,0,"ion-spinner",8),s.Jb()}if(2&t){var e=s.Ub();s.Xb("disabled",e.loading),s.xb(2),s.Xb("ngIf",e.cancelLoading)}}function g(t,n){if(1&t){var o=s.Lb();s.Kb(0,"ion-item"),s.Kb(1,"ion-label",12),s.Kb(2,"h2"),s.lc(3),s.Jb(),s.Kb(4,"p"),s.lc(5),s.Jb(),s.Jb(),s.Kb(6,"ion-button",13),s.Sb("click",(function(){s.ec(o);var t=n.$implicit;return s.Ub(2).downloadInvoice(t.id)})),s.lc(7," Download "),s.Jb(),s.Jb()}if(2&t){var e=n.$implicit;s.xb(3),s.nc("Paid ",e.total,""),s.xb(2),s.nc(" ",e.date," ")}}function d(t,n){if(1&t&&(s.Kb(0,"ion-list",10),s.Kb(1,"ion-list-header"),s.lc(2," Invoices "),s.Jb(),s.kc(3,g,8,2,"ion-item",11),s.Jb()),2&t){var o=s.Ub();s.xb(3),s.Xb("ngForOf",o.invoices)}}var m=function(){function t(t,n,o,e,i,c,s){var r=this;this.billingService=t,this.modalController=n,this.alertController=o,this.authenticationService=e,this.iab=i,this.toastController=c,this.storage=s,this.user={},this.authenticationService.getUserData().subscribe((function(t){r.user=t})),this.loading=!0,this.invoices=[],this.getInvoices()}return t.prototype.ngOnInit=function(){},t.prototype.getInvoices=function(){var t=this;this.billingService.getInvoices().then((function(n){t.loading=!1,t.invoices=n}))},t.prototype.downloadInvoice=function(t){var n=this;this.storage.get("go_token").then((function(o){o&&n.iab.create(c.a.apiUrl+"/invoices/"+t+"?token="+o,"_system")}))},t.prototype.cancelSubscription=function(){return Object(e.a)(this,void 0,void 0,(function(){var t=this;return Object(e.c)(this,(function(n){switch(n.label){case 0:return[4,this.alertController.create({header:"Cancel Subscription",message:"Are you sure?",buttons:[{text:"Cancel",role:"cancel",handler:function(){}},{text:"Yes",handler:function(){t.cancelLoading=!0,t.billingService.cancel().then((function(){t.showToast("Subscription Cancelled"),t.getInvoices(),t.authenticationService.getUserData().toPromise().then((function(n){t.user=n}))})).catch((function(n){t.cancelLoading=!1,t.showToast("Failed To Cancel Subscription")}))}}]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.prototype.showToast=function(t){return Object(e.a)(this,void 0,void 0,(function(){return Object(e.c)(this,(function(n){switch(n.label){case 0:return[4,this.toastController.create({message:t,duration:4e3})];case 1:return n.sent().present(),[2]}}))}))},t.prototype.formatDate=function(t){return i(t).format("dddd, MMMM Do YYYY")},t.prototype.formatTime=function(t){return i(t).format("h:mma")},t.prototype.dismiss=function(){this.modalController.dismiss()},t.\u0275fac=function(n){return new(n||t)(s.Hb(r.a),s.Hb(a.L),s.Hb(a.a),s.Hb(l.a),s.Hb(u.a),s.Hb(a.S),s.Hb(b.b))},t.\u0275cmp=s.Bb({type:t,selectors:[["app-billing"]],decls:10,vars:2,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close"],[1,"billing"],["color","primary",3,"disabled","click",4,"ngIf"],["class","billing__billing-list",4,"ngIf"],["color","primary",3,"disabled","click"],["color","light","class","billing__cancel-spinner",4,"ngIf"],["color","light",1,"billing__cancel-spinner"],[1,"billing__billing-list"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["slot","end",3,"click"]],template:function(t,n){1&t&&(s.Kb(0,"ion-header"),s.Kb(1,"ion-toolbar",0),s.Kb(2,"ion-buttons",1),s.Kb(3,"ion-button",2),s.Sb("click",(function(){return n.dismiss()})),s.Ib(4,"ion-icon",3),s.Jb(),s.Jb(),s.Kb(5,"ion-title"),s.lc(6,"Billing"),s.Jb(),s.Jb(),s.Jb(),s.Kb(7,"ion-content",4),s.kc(8,h,3,2,"ion-button",5),s.kc(9,d,4,1,"ion-list",6),s.Jb()),2&t&&(s.xb(8),s.Xb("ngIf",n.user.stripe_id&&n.user.subscription&&!n.user.subscription.ends_at),s.xb(1),s.Xb("ngIf",n.invoices&&n.invoices.length>0))},directives:[a.o,a.G,a.h,a.g,a.p,a.F,a.k,p.j,a.D,a.u,a.v,p.i,a.r,a.t],styles:[""]}),t}()},nD9t:function(t,n,o){"use strict";o.d(n,"a",(function(){return u}));var e=o("mrSG"),i=o("OAiQ"),c=o("fXoL"),s=o("TEn/"),r=o("ri4K"),a=o("m/P+"),l=o("bANG"),u=function(){function t(t,n,o,e,i,c,s){var r=this;this.plt=t,this.authenticationService=n,this.alertCtrl=o,this.iab=e,this.modalController=i,this.layerService=c,this.loadingController=s,this.user={},this.authenticationService.getUserData().subscribe((function(t){r.user=t}))}return t.prototype.ngOnInit=function(){},t.prototype.openRate=function(){this.plt.is("ios")?this.iab.create("https://apps.apple.com/us/app/","_system"):this.iab.create("https://play.google.com/store/apps/details?id=com.myoutdoors.app","_system")},t.prototype.openFollow=function(){this.iab.create("https://www.facebook.com/Getoutdoorsmapsnz","_system")},t.prototype.openEmail=function(){this.iab.create("mailto:hello@my-outdoors.co.nz","_system")},t.prototype.syncOffline=function(){this.layerService.syncOfflineData(),this.alertCtrl.create({header:"Sync Started",message:"Your offline data is syncing in the background. You can continue to use the app while the sync is in progress.",buttons:[{text:"Dismiss",role:"cancel",handler:function(t){}}]}).then((function(t){t.present()}))},t.prototype.openBilling=function(){return Object(e.a)(this,void 0,void 0,(function(){var t;return Object(e.c)(this,(function(n){switch(n.label){case 0:return[4,this.modalController.create({component:i.a,componentProps:{}})];case 1:return(t=n.sent()).onDidDismiss().then((function(t){})),[4,t.present()];case 2:return n.sent(),[2]}}))}))},t.prototype.openChangePassword=function(){var t=this;this.alertCtrl.create({header:"Change Password",inputs:[{name:"password",placeholder:"Password",type:"password"},{name:"confirmPassword",placeholder:"Confirm Password",type:"password"}],buttons:[{text:"Cancel",role:"cancel",handler:function(t){}},{text:"Change",handler:function(n){n.password&&n.confirmPassword&&n.password===n.confirmPassword?t.authenticationService.changePassword(t.user.email,n.password,n.confirmPassword).then((function(){t.alertCtrl.create({header:"Success",message:"Your password has been updated",buttons:[{text:"Dismiss",role:"cancel",handler:function(t){}}]}).then((function(t){t.present()}))})).catch((function(){t.alertCtrl.create({header:"Error",message:"There was an error while changing your password.",buttons:[{text:"Cancel",role:"cancel",handler:function(t){}},{text:"Try Again",handler:function(n){setTimeout((function(){t.openChangePassword()}),200)}}]}).then((function(t){t.present()}))})):t.alertCtrl.create({header:"Error",message:"Passwords do not match",buttons:[{text:"Cancel",role:"cancel",handler:function(t){}},{text:"Try Again",handler:function(n){setTimeout((function(){t.openChangePassword()}),200)}}]}).then((function(t){t.present()}))}}]}).then((function(t){t.present()}))},t.prototype.logout=function(){this.authenticationService.logout()},t.prototype.dismiss=function(){this.modalController.dismiss()},t.\u0275fac=function(n){return new(n||t)(c.Hb(s.O),c.Hb(r.a),c.Hb(s.a),c.Hb(a.a),c.Hb(s.L),c.Hb(l.a),c.Hb(s.J))},t.\u0275cmp=c.Bb({type:t,selectors:[["app-settings"]],decls:45,vars:0,consts:[["color","primary"],["slot","start"],[3,"click"],["name","close"],[1,"settings-list"],["detail","",3,"click"],["name","globe","slot","start"],["name","heart","slot","start"],["slot","end","fill","outline",3,"click"],["name","logo-facebook","slot","start"],["name","mail","slot","start"],["name","card","slot","start"],["name","lock-open","slot","start"],["name","lock-closed","slot","start"]],template:function(t,n){1&t&&(c.Kb(0,"ion-header"),c.Kb(1,"ion-toolbar",0),c.Kb(2,"ion-buttons",1),c.Kb(3,"ion-button",2),c.Sb("click",(function(){return n.dismiss()})),c.Ib(4,"ion-icon",3),c.Jb(),c.Jb(),c.Kb(5,"ion-title"),c.lc(6,"Settings"),c.Jb(),c.Jb(),c.Jb(),c.Kb(7,"ion-content"),c.Kb(8,"ion-list",4),c.Kb(9,"ion-list-header"),c.lc(10,"Data"),c.Jb(),c.Kb(11,"ion-item",5),c.Sb("click",(function(){return n.syncOffline()})),c.Ib(12,"ion-icon",6),c.Kb(13,"ion-label"),c.lc(14,"Sync Offline Data"),c.Jb(),c.Jb(),c.Kb(15,"ion-list-header"),c.lc(16,"Support"),c.Jb(),c.Kb(17,"ion-item"),c.Ib(18,"ion-icon",7),c.lc(19," Rate The App "),c.Kb(20,"ion-button",8),c.Sb("click",(function(){return n.openRate()})),c.lc(21,"Rate"),c.Jb(),c.Jb(),c.Kb(22,"ion-item"),c.Ib(23,"ion-icon",9),c.lc(24," Follow Us "),c.Kb(25,"ion-button",8),c.Sb("click",(function(){return n.openFollow()})),c.lc(26,"Follow"),c.Jb(),c.Jb(),c.Kb(27,"ion-item"),c.Ib(28,"ion-icon",10),c.lc(29," Contact Support "),c.Kb(30,"ion-button",8),c.Sb("click",(function(){return n.openEmail()})),c.lc(31,"Email"),c.Jb(),c.Jb(),c.Kb(32,"ion-list-header"),c.lc(33,"Account Settings"),c.Jb(),c.Kb(34,"ion-item",5),c.Sb("click",(function(){return n.openBilling()})),c.Ib(35,"ion-icon",11),c.Kb(36,"ion-label"),c.lc(37,"Billing"),c.Jb(),c.Jb(),c.Kb(38,"ion-item",5),c.Sb("click",(function(){return n.openChangePassword()})),c.Ib(39,"ion-icon",12),c.Kb(40,"ion-label"),c.lc(41,"Change Password"),c.Jb(),c.Jb(),c.Kb(42,"ion-item",2),c.Sb("click",(function(){return n.logout()})),c.Ib(43,"ion-icon",13),c.lc(44," Logout "),c.Jb(),c.Jb(),c.Jb())},directives:[s.o,s.G,s.h,s.g,s.p,s.F,s.k,s.u,s.v,s.r,s.t],styles:[".settings-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{margin-bottom:10px;margin-top:20px;padding-top:10px}.settings-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]:first-child{margin-top:0;padding-top:0}.settings-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}.settings-list[_ngcontent-%COMP%]   ion-icon[name=trophy][_ngcontent-%COMP%]{color:#ffbf00}.settings-list[_ngcontent-%COMP%]   ion-icon[name=heart][_ngcontent-%COMP%]{color:#e31b23}.settings-list[_ngcontent-%COMP%]   ion-icon[name=logo-facebook][_ngcontent-%COMP%]{color:#1778f2}.settings-list[_ngcontent-%COMP%]   ion-icon[name=logo-twitter][_ngcontent-%COMP%]{color:#1da1f2}.settings-list[_ngcontent-%COMP%]   ion-icon[name=mail][_ngcontent-%COMP%]{color:#444}.settings-list[_ngcontent-%COMP%]   ion-icon[name=lock-open][_ngcontent-%COMP%]{color:#d6a000}.settings-list[_ngcontent-%COMP%]   ion-icon[name=lock-closed][_ngcontent-%COMP%]{color:#d47835}.settings-list[_ngcontent-%COMP%]   ion-icon[name=cloud-upload][_ngcontent-%COMP%]{color:#8cd0ef}.settings-list[_ngcontent-%COMP%]   ion-icon[name=locate][_ngcontent-%COMP%]{color:#90e483}"]}),t}()},yPrK:function(t,n,o){"use strict";o.r(n),o.d(n,"SettingsPageModule",(function(){return u}));var e=o("ofXK"),i=o("3Pt+"),c=o("tyNb"),s=o("TEn/"),r=o("nD9t"),a=o("fXoL"),l=[{path:"",component:r.a}],u=function(){function t(){}return t.\u0275mod=a.Fb({type:t}),t.\u0275inj=a.Eb({factory:function(n){return new(n||t)},imports:[[e.b,i.a,s.H,c.j.forChild(l)]]}),t}()}}]);